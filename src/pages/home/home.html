<ion-header>
  <ion-navbar>
    <ion-title>Home</ion-title>
  </ion-navbar>
</ion-header>

<ion-content padding>
  <!--logout link-->
  <span style="float:right; color:chocolate;font-size:17px; font-weight:bold" (click)="logout()">logout</span>

  <!--refresh page-->
  <ion-refresher (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-col *ngFor="let domestic_quote of domestic_quotes; let i = index">
    <ion-card style="padding-bottom:0px; margin-bottom:0px" [ngClass]="{active: isLevel1Shown('idx'+i)}">
      <ion-card-header>
        <ion-row class="tiny-date-row">
              <ion-col>Quote for : {{domestic_quote.date}}; Valid: Until 8 PM</ion-col><ion-col>.</ion-col>
        </ion-row>
        <ion-row>
          <ion-col (click)="toggleLevel1('idx'+i)"><span class="header-text">Q-Price</span><br>(Rs/Kg)<br>{{domestic_quote.rate}}</ion-col>
          <ion-col (click)="toggleLevel1('idx'+i)"><span class="header-text">Last Bid</span><br>(spc | You)<br><span *ngIf="domestic_quote.hasOwnProperty('latest_bid_info')">{{domestic_quote.latest_bid_info.spc_rate}}</span> | <span *ngIf="domestic_quote.hasOwnProperty('latest_bid_info')">{{domestic_quote.latest_bid_info.buyer_rate}}</span></ion-col>
          <ion-col> <span class="header-text">Quantity</span><br>(Kgs)<br><input type="number" [(ngModel)]="order_quantity" placeholder="Quantity" style="background-color:bisque"></ion-col>
          <ion-col>
              <button ion-button color="dark" (click)="toggleLevel1('idx'+i, domestic_quote.id, i)">Bid/Trace {{ i }}</button>
              <br>
              <button ion-button color="secondary" (click)="orderItem(order_quantity, domestic_quote.id, domestic_quote.latest_bid_info.spc_rate, domestic_quote.latest_bid_info.buyer_rate, domestic_quote.latest_bid_info.bid_status)">Order</button>
          </ion-col>
        </ion-row>
      </ion-card-header>
    </ion-card>

    <!-- bidding trace/history card -->
    <ion-card class="bidding-trail-card" style="transition: width 2s, height 2s, transform 2s;" *ngIf="isLevel1Shown('idx'+i)">
      <ion-card-header>
        <span><i><b>Bidding trail</b></i></span>
      </ion-card-header>


    <span  *ngFor="let bidding of bidding_history">
      <div [ngClass]="bidding.last_bidder.name=='owner' ? 'speech-bubble-owner' : 'speech-bubble-buyer'">
        <div class="speech-bubble">
          <!-- <div class="arrow bottom right"></div> -->
          <span *ngIf="bidding.last_bidder.name=='owner'">
            <span class="chat-bubble-name">Spc:</span>
            {{bidding.spc_rate}} Rs.
          </span>
          <span *ngIf="bidding.last_bidder.name!='owner'">
              <span class="chat-bubble-name">You:</span>
              {{bidding.buyer_rate}} Rs. ({{bidding.buyer_quantity}} Kgs)
          </span>
        </div>
      </div>
      <br>
      <br>
    </span>
    <br>
    <br>
    <span *ngIf="domestic_quote.hasOwnProperty('latest_bid_info')">
      <span class="bidding-status" *ngIf="domestic_quote.latest_bid_info.bid_status==3">Bid Accepted & Closed</span>
      <span class="bidding-status" *ngIf="domestic_quote.latest_bid_info.bid_status==2">Bidding Expired!</span>
      <span class="bidding-status loading" *ngIf="domestic_quote.latest_bid_info.bid_status==1">Accepting Bidding</span>
    </span>
    <span class="bidding-status loading" *ngIf="!domestic_quote.hasOwnProperty('latest_bid_info')">Accepting Bidding</span>
    <br>
    <br>
    <span class="bidding-status" *ngIf="domestic_quote.latest_bid_info.bid_status==3">Bid Accepted & Closed</span>
    <span class="bidding-status" *ngIf="domestic_quote.latest_bid_info.bid_status==2">Bidding Expired!</span>
    <span class="bidding-status loading" *ngIf="domestic_quote.latest_bid_info.bid_status==1">Accepting Bidding</span>
    <br>
    <br>
    <br>
    <ion-card class="message-bidform-card">
      <span *ngIf="(domestic_quote.hasOwnProperty('latest_bid_info') && domestic_quote.latest_bid_info.bid_status!=3) || !domestic_quote.hasOwnProperty('latest_bid_info')">
        <ion-row>
          <ion-col><input type="text" placeholder="message" [(ngModel)]="message" style="background-color:rgb(255, 255, 255); width: 200px" padding-left="10px"></ion-col>
          <ion-col><button ion-button (click)="onSendMessage(message, domestic_quote.id)">Send</button></ion-col>
        </ion-row>
        <hr>
        <!--<ion-card-header><span><i><b>Bid Now</b></i></span></ion-card-header>-->
        <ion-row>
          <ion-col><ion-card-header><span><i><b>Bid:</b></i></span></ion-card-header></ion-col>
          <ion-col><span class="header-text">Rate(Rs/Kg)</span><br><input type="number" placeholder="Rate" [(ngModel)]="rate" style="background-color:bisque"></ion-col>
          <ion-col><span class="header-text">Quantity</span><br><input type="number" placeholder="Quantity" [(ngModel)]="quantity" style="background-color:bisque"></ion-col>
          <ion-col><button ion-button (click)="bidding(quantity, domestic_quote.id, 'bidding', rate)">Bid</button></ion-col>
        </ion-row>
      </span>
    </ion-card>
    <!-- <span *ngIf="(domestic_quote.hasOwnProperty('latest_bid_info') && domestic_quote.latest_bid_info.bid_status!=3) || !domestic_quote.hasOwnProperty('latest_bid_info')">
      <hr>

      <ion-card-header>
        <span><i><b>Bid Now</b></i></span>
        </ion-card-header>
        <ion-row>
          <ion-col><span class="header-text">Rate(Rs/Kg)</span><br><input type="number" placeholder="Rate" [(ngModel)]="rate" style="background-color:bisque"></ion-col>
          <ion-col><span class="header-text">Quantity</span><br><input type="number" placeholder="Quantity" [(ngModel)]="quantity" style="background-color:bisque"></ion-col>
          <ion-col><button ion-button (click)="bidding(quantity, domestic_quote.id, 'bidding', rate, i)">Bid</button></ion-col>
        </ion-row>
    </span> -->
    </ion-card>

    <!-- delevery option card -->
    <ion-card *ngIf="show_delevery_option" style="padding-top:0px; margin-top:0px">
      <ion-card-header>
        <ion-item>
          <ion-label>Door delivery</ion-label>
          <ion-checkbox (ionChange)=doorDelivery($event,domestic_quote.latest_bid_info.spc_rate)></ion-checkbox>
        </ion-item>
        <ion-item>
          <ion-label>Date of deliver</ion-label>
          <ion-input type="date" [(ngModel)]="delivery_date"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Hold</ion-label>
          <ion-checkbox (ionChange)=doorDelivery($event,domestic_quote.latest_bid_info.spc_rate)></ion-checkbox>
        </ion-item>
        Total amount = {{total_delivery_amount}}
      </ion-card-header>  
    </ion-card>

    </ion-col>
</ion-content>
